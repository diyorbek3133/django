<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dictionary Dashboard</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #333;
    margin: 0;
    padding: 30px;
    min-height: 100vh;
}
h2 { text-align: center; color: white; margin-bottom: 30px; }
.logout-container { position: fixed; top: 20px; right: 20px; z-index: 1000; }
.logout-btn { padding: 10px 20px; background-color: #e74c3c; color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.3s; }
.logout-btn:hover { background-color: #c0392b; }
.input-container { display: flex; justify-content: center; margin-bottom: 20px; gap: 10px; flex-wrap: wrap; }
input { padding: 10px; border-radius: 12px; border: 1px solid #d1d5db; width: 200px; transition: 0.3s; }
input:focus { border-color: #4f46e5; box-shadow: 0 0 0 0.2rem rgba(79, 70, 229, 0.25); outline: none; }
.add-btn { padding: 10px 20px; border: none; background: linear-gradient(90deg, #4f46e5, #6366f1); color: white; border-radius: 50px; font-weight: 600; cursor: pointer; transition: 0.3s; }
.add-btn:hover { background: linear-gradient(90deg, #4338ca, #4f46e5); }
table { width: 80%; margin: 0 auto; border-collapse: collapse; background-color: white; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
th { background-color: #4f46e5; color: white; }
tr:nth-child(even) { background-color: #f2f6fc; }
tr:hover { background-color: #e8f0fe; }
@media(max-width: 700px) { table, .input-container { width: 100%; } input { width: 100%; } }
</style>
</head>
<body>

<h2>Dictionary Dashboard</h2>

<!-- Logout -->
<div class="logout-container">
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="logout-btn">Logout</button>
    </form>
</div>

<!-- Add word -->
<div class="input-container">
    <input type="text" id="word" placeholder="Word">
    <input type="text" id="definition" placeholder="Definition">
    <input type="text" id="meaning" placeholder="Meaning">
    <button class="add-btn" onclick="addWord()">Add</button>
</div>

<!-- Table -->
<table>
    <thead>
        <tr>
            <th>Word</th>
            <th>Definition</th>
            <th>Meaning</th>
        </tr>
    </thead>
    <tbody id="table-body">
        {% for w in words %}
        <tr>
            <td>{{ w.word }}</td>
            <td>{{ w.definition }}</td>
            <td>{{ w.meaning }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="3" style="text-align:center;">No words yet.</td></tr>
        {% endfor %}
    </tbody>
</table>

<script>
const API_URL = "/api/";

// CSRF
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + "=")) {
                cookieValue = decodeURIComponent(cookie.slice(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
const csrftoken = getCookie("csrftoken");

// Add word
async function addWord() {
    const wordInput = document.getElementById("word");
    const definitionInput = document.getElementById("definition");
    const meaningInput = document.getElementById("meaning");

    const word = wordInput.value.trim();
    const definition = definitionInput.value.trim();
    const meaning = meaningInput.value.trim();

    if (!word || !definition || !meaning) {
        alert("All fields are required!");
        return;
    }

    try {
        const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken },
            body: JSON.stringify({ word, definition, meaning })
        });

        if (!response.ok) {
            const error = await response.json();
            alert("Error: " + (error.message || JSON.stringify(error)));
            return;
        }

        const tbody = document.getElementById("table-body");

        // Remove "No words yet." row if it exists
        const emptyRow = tbody.querySelector('tr td[colspan="3"]');
        if (emptyRow) emptyRow.parentElement.remove();

        // Add new row
        const newRow = document.createElement("tr");
        newRow.innerHTML = `<td>${word}</td><td>${definition}</td><td>${meaning}</td>`;
        tbody.appendChild(newRow);

        // Clear inputs
        wordInput.value = "";
        definitionInput.value = "";
        meaningInput.value = "";

        wordInput.focus();

    } catch (err) {
        console.error("Add word error:", err);
        alert("An error occurred. Check console.");
    }
}
</script>

</body>
</html>
